<div class="container-fluid mt-3" style="background-color: #F7F9FB; min-height: 100vh; padding: 2rem;">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-11">
            <!-- Header -->
            <div class="mb-4">
                <h1 class="text-dark mb-3">
                    <i class="fa fa-calendar me-2" style="color: #7ECEC5;"></i>
                    Calendario de Reservas
                </h1>
                <p class="text-muted">Gestiona las reservas de tus propiedades</p>
            </div>

            <!-- Selector de Tipología -->
            <div class="card bg-white border shadow-sm mb-4">
                <div class="card-body">
                    <label for="tipologia_habitacion" class="form-label text-dark">
                        <i class="fa fa-home me-2"></i>Selecciona una cabaña
                    </label>
                    <select name="tipologia_habitacion" id="tipologia_habitacion" class="form-select form-select-lg">
                        <option value="" selected="true" disabled="true">Selecciona una cabaña para visualizar su calendario...</option>
                        {{#if chalets}}
                        {{#each chalets}}
                        <option value="{{this.name}}" data-bs-id="{{this.id}}">{{this.name}}</option>
                        {{/each}}
                        {{else}}
                        <option value="0">No se encontraron cabañas</option>
                        {{/if}}
                    </select>
                </div>
            </div>

            <!-- Leyenda de Colores -->
            <div class="card bg-white border shadow-sm mb-4" id="legend-card" style="display: none;">
                <div class="card-body">
                    <h6 class="text-dark mb-3">
                        <i class="fa fa-info-circle me-2"></i>Leyenda de Tipos de Reserva
                    </h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <div style="width: 24px; height: 24px; background-color: #10b981; border: 2px solid #059669; border-radius: 4px; margin-right: 10px;"></div>
                                <span class="text-dark">
                                    <strong>Reserva NyN</strong>
                                    <br><small class="text-muted">Reservas de clientes normales</small>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <div style="width: 24px; height: 24px; background-color: #8b5cf6; border: 2px solid #7c3aed; border-radius: 4px; margin-right: 10px;"></div>
                                <span class="text-dark">
                                    <strong>Reserva de Dueño</strong>
                                    <br><small class="text-muted">Reservas externas y personales del propietario</small>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="fa fa-lightbulb-o me-2"></i>
                        <strong>Tip:</strong> Haz clic en cualquier reserva de dueño para editarla. Las reservas NyN son de solo lectura.
                    </div>
                </div>
            </div>

            <!-- Calendario -->
            <div class="card bg-white border shadow-sm">
                <div class="card-body p-3">
                    <div id="calendar" style="display: none;"></div>
                </div>
            </div>

            <!-- Botón para volver -->
            <div class="mt-4 text-center">
                <input type="hidden" id="privilege" value="{{privilege}}">
                {{#if (eq privilege 'Inversionistas')}}
                <a class="btn btn-outline-primary btn-lg" href="/api/calendar/colaboradorduenos" role="button">
                    <i class="fa fa-table me-2"></i>Cambiar a vista de tabla
                </a>
                {{else if (eq privilege 'Colaborador dueño')}}
                <a class="btn btn-outline-primary btn-lg" href="/api/calendar/colaboradorduenos" role="button">
                    <i class="fa fa-table me-2"></i>Cambiar a vista de tabla
                </a>
                {{else}}
                <a class="btn btn-outline-primary btn-lg" href="/api/calendar/duenos" role="button">
                    <i class="fa fa-table me-2"></i>Cambiar a vista de tabla
                </a>
                {{/if}}
            </div>
        </div>
    </div>
</div>

<style>
    /* Light mode para FullCalendar */
    .fc {
        background-color: #FFFFFF;
        color: #2C3E50;
    }
    
    .fc .fc-toolbar-title {
        color: #2C3E50;
        font-size: 1.5rem;
    }
    
    .fc .fc-button {
        background-color: #7ECEC5;
        border-color: #5FBFB3;
        color: #fff;
    }
    
    .fc .fc-button:hover {
        background-color: #5FBFB3;
        border-color: #4BA89E;
    }
    
    .fc .fc-button-primary:not(:disabled):active,
    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background-color: #5FBFB3;
        border-color: #4BA89E;
    }
    
    .fc .fc-col-header-cell {
        background-color: #7ECEC5;
        color: #fff;
        border-color: #5FBFB3;
    }
    
    .fc .fc-daygrid-day {
        background-color: #FFFFFF;
        border-color: #E3E8EE;
    }
    
    .fc .fc-daygrid-day:hover {
        background-color: #F7F9FB;
    }
    
    .fc .fc-daygrid-day-number {
        color: #2C3E50;
    }
    
    .fc .fc-day-today {
        background-color: #A8DDD7 !important;
    }
    
    .fc .fc-day-other {
        background-color: #F7F9FB;
    }
    
    .fc-event {
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .fc-event:hover {
        transform: scale(1.02);
        z-index: 100;
    }
    
    /* IMPORTANTE: Sobrescribir TODOS los estilos de color predeterminados de FullCalendar */
    .fc-event, 
    .fc-event-main,
    .fc-daygrid-event,
    .fc-h-event {
        background-color: transparent !important;
        border-color: transparent !important;
    }
    
    /* Asegurar que los eventos usen solo nuestros colores personalizados */
    .fc-event .fc-event-main-frame {
        background-color: inherit !important;
        border-color: inherit !important;
    }
    
    /* Hacer que los eventos ocupen todo el ancho disponible */
    .fc-daygrid-event {
        margin: 0 !important;
        padding: 0 !important;
    }
    
    .fc-daygrid-event-harness {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
    
    .fc-daygrid-block-event .fc-event-main {
        padding: 0 !important;
    }
    
    /* Asegurar que el contenido personalizado ocupe todo el espacio */
    .fc-event-main {
        width: 100% !important;
    }
</style>

<script>
    // Mostrar leyenda cuando se selecciona una cabaña
    document.getElementById('tipologia_habitacion').addEventListener('change', function() {
        if (this.value) {
            document.getElementById('legend-card').style.display = 'block';
        }
    });
</script>

<script src="/scripts/ownerChaletCalendar.js"></script>