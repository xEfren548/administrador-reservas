{{#if reservation}}
<style>
    /* Custom styles for paraUsuarios */
    .hero-carousel {
        position: relative;
        border-radius: 0 0 24px 24px;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }
    
    .hero-carousel .carousel-item > div {
        height: 50vh;
        min-height: 350px;
    }
    
    .hero-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.6));
        padding: 2rem;
        z-index: 10;
    }
    
    .property-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #fff;
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        margin: 0;
    }
    
    .info-card {
        background: #fff;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #E3E8EE;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .info-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    
    .info-card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .info-card-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    
    .icon-mint { background: rgba(126, 206, 197, 0.15); color: #7ECEC5; }
    .icon-coral { background: rgba(255, 107, 107, 0.15); color: #FF6B6B; }
    .icon-blue { background: rgba(59, 130, 246, 0.15); color: #3B82F6; }
    .icon-success { background: rgba(16, 185, 129, 0.15); color: #10B981; }
    
    .info-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #6B7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }
    
    .info-value {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1A1A2E;
    }
    
    .guest-card {
        background: linear-gradient(135deg, #7ECEC5 0%, #5FBFB3 100%);
        border-radius: 16px;
        padding: 1.5rem;
        color: #fff;
    }
    
    .guest-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid rgba(255,255,255,0.5);
        object-fit: cover;
    }
    
    .guest-name {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        color: #fff;
    }
    
    .guest-email {
        font-size: 0.875rem;
        opacity: 0.9;
    }
    
    .notes-card {
        background: #FFFBEB;
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid #FDE68A;
    }
    
    .notes-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .notes-title {
        font-weight: 600;
        color: #92400E;
        margin: 0;
    }
    
    .note-item {
        background: #fff;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        border-left: 3px solid #F59E0B;
    }
    
    .weather-card {
        background: linear-gradient(135deg, #7ECEC5 0%, #5FBFB3 100%);
        border-radius: 16px;
        padding: 1.5rem;
        color: #fff;
        text-align: center;
    }
    
    .weather-temp {
        font-size: 3rem;
        font-weight: 700;
        line-height: 1;
    }
    
    .weather-icon {
        font-size: 3rem;
        margin-bottom: 0.5rem;
    }
    
    .weather-city {
        font-size: 0.875rem;
        opacity: 0.9;
    }
    
    .btn-checkin {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        border: none;
        color: #fff;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.2s ease;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .btn-checkin:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        color: #fff;
    }
    
    .btn-instructions {
        background: #fff;
        border: 2px solid #7ECEC5;
        color: #7ECEC5;
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.2s ease;
    }
    
    .btn-instructions:hover {
        background: #7ECEC5;
        color: #fff;
    }
    
    .map-container {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .map-container iframe {
        width: 100%;
        height: 300px;
        border: none;
    }
    
    .description-card {
        background: #fff;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #E3E8EE;
    }
    
    .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1A1A2E;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .section-title i {
        color: #7ECEC5;
    }
    
    .checkin-done-badge {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        color: #fff;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    /* Modal styles */
    .modal-content.update-info {
        border-radius: 20px;
        border: none;
        box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }
    
    .modal-content.update-info .modal-header {
        background: linear-gradient(135deg, #7ECEC5 0%, #5FBFB3 100%);
        color: #fff;
        border-radius: 20px 20px 0 0;
        padding: 1.5rem;
    }
    
    .modal-content.update-info .modal-title {
        font-weight: 700;
    }
    
    .modal-content.update-info .modal-body {
        padding: 2rem;
    }
    
    .modal-content.update-info .modal-footer {
        padding: 1rem 2rem 2rem;
        border: none;
    }
    
    .signature .canvas {
        position: relative;
        border: 2px dashed #E3E8EE;
        border-radius: 12px;
        padding: 1rem;
        background: #F7F9FB;
    }
    
    .signature canvas {
        border-radius: 8px;
        background: #fff;
        display: block;
        margin: 0 auto;
    }
    
    .delete-signature {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: #FF6B6B;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.5rem;
        cursor: pointer;
        z-index: 10;
    }
    
    .btn-save {
        background: linear-gradient(135deg, #7ECEC5 0%, #5FBFB3 100%);
        border: none;
        color: #fff;
        padding: 0.75rem 2rem;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(126, 206, 197, 0.4);
    }
    
    .checkbox-option {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .checkbox-option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #7ECEC5;
    }
</style>

<div class="bg-light min-vh-100">
    <!-- Hero Carousel -->
    <div class="hero-carousel">
        <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
            <ol class="carousel-indicators">
                {{#each chalet.images}}
                <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{@index}}" class="{{#if @first}}active{{/if}}"></li>
                {{/each}}
            </ol>
            <div class="carousel-inner">
                {{#each chalet.images}}
                <div class="carousel-item {{#if @first}}active{{/if}}">
                    <div class="d-block w-100" style="background-image: url('https://navarro.integradev.site/navarro/{{this}}'); background-repeat: no-repeat; background-size: cover; background-position: center;"></div>
                </div>
                {{/each}}
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </a>
            <div class="hero-overlay">
                <h1 class="property-title">{{chalet.propertyDetails.name}}</h1>
                <p class="text-white mb-0 opacity-75"><i class="fa fa-map-marker me-2"></i>{{chalet.propertyDetails.propertyDetails}}</p>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-7">
                <!-- Guest Info Card -->
                <div class="guest-card mb-4">
                    <div class="d-flex align-items-center gap-3">
                        <img src="https://panel.hotelgest.com/files/media/male_profile_sm.jpg" alt="Guest" class="guest-avatar">
                        <div>
                            <h4 class="guest-name">{{client.fullName}}</h4>
                            <p class="guest-email mb-0"><i class="fa fa-envelope me-2"></i>{{client.email}}</p>
                        </div>
                    </div>
                </div>

                <!-- Reservation Info Cards -->
                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-3">
                        <div class="info-card text-center">
                            <div class="info-card-icon icon-mint mx-auto mb-2">
                                <i class="fa fa-sign-in"></i>
                            </div>
                            <div class="info-label">Llegada</div>
                            <div class="info-value" id="arrivalDate">{{reservation.arrivalDate}}</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="info-card text-center">
                            <div class="info-card-icon icon-coral mx-auto mb-2">
                                <i class="fa fa-sign-out"></i>
                            </div>
                            <div class="info-label">Salida</div>
                            <div class="info-value" id="departureDate">{{reservation.departureDate}}</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="info-card text-center">
                            <div class="info-card-icon icon-blue mx-auto mb-2">
                                <i class="fa fa-bed"></i>
                            </div>
                            <div class="info-label">Noches</div>
                            <div class="info-value">{{reservation.nNights}}</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="info-card text-center">
                            <div class="info-card-icon icon-success mx-auto mb-2">
                                <i class="fa fa-calendar"></i>
                            </div>
                            <div class="info-label">Reservada</div>
                            <div class="info-value" id="reservationDate">{{reservation.reservationDate}}</div>
                        </div>
                    </div>
                </div>

                <!-- Description Card -->
                <div class="description-card mb-4">
                    <h5 class="section-title"><i class="fa fa-info-circle"></i> Acerca del alojamiento</h5>
                    <p class="text-muted mb-3">{{chalet.accomodationDescription}}</p>
                    
                    <div class="d-flex flex-wrap gap-2">
                        {{#if chalet.files}}
                        <a href="https://navarro.integradev.site/navarro/{{chalet.files}}" class="btn btn-instructions">
                            <i class="fa fa-map-signs me-2"></i>Instrucciones de llegada
                        </a>
                        {{else}}
                        <button class="btn btn-instructions" disabled>
                            <i class="fa fa-map-signs me-2"></i>Instrucciones no disponibles
                        </button>
                        {{/if}}
                        
                        <div class="some-div-1">
                            <div class="some-div-2">
                                <add-to-calendar-button name="My Event" startDate="2022-04-15" endDate="2022-04-17"
                                    options="['Google', 'Apple', 'Outlook.com', 'Microsoft365', 'MicrosoftTeams', 'Yahoo', 'iCal']">
                                </add-to-calendar-button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map -->
                <div class="map-container">
                    <iframe src="https://www.google.com/maps?q={{chalet.location.latitude}},{{chalet.location.longitude}}&z=16&output=embed" 
                            allowfullscreen="" loading="lazy">
                    </iframe>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-5">
                <!-- Weather Card -->
                <div id="weather" class="mb-4"></div>

                <!-- Notes Card -->
                <div class="notes-card mb-4">
                    <div class="notes-header">
                        <i class="fa fa-sticky-note" style="color: #F59E0B;"></i>
                        <h5 class="notes-title">Comentarios</h5>
                    </div>
                    {{#if reservation.notes}}
                    {{#each reservation.notes}}
                    <div class="note-item">
                        <p class="mb-0 text-dark">{{this.texto}}</p>
                    </div>
                    {{/each}}
                    {{else}}
                    <div class="note-item">
                        <p class="mb-0 text-muted">No se han agregado notas para esta reserva</p>
                    </div>
                    {{/if}}
                </div>

                <!-- Check-in Section -->
                <div class="info-card text-center">
                    <h5 class="section-title justify-content-center"><i class="fa fa-check-circle"></i> Estado de Check-In</h5>
                    {{#if reservation.madeCheckIn}}
                    <div class="checkin-done-badge">
                        <i class="fa fa-check"></i> Check In Realizado
                    </div>
                    {{else}}
                    <p class="text-muted mb-3">Realiza tu check-in para confirmar tu llegada</p>
                    <button class="btn btn-checkin" id="checkin-btn" data-reservationid="{{reservation._id}}">
                        <i class="fa fa-sign-in me-2"></i>Realizar Check In
                    </button>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>

    <div class="form-item">
        <p id="txtSubmitReservationError" name="errMsg" class="error"></p>
    </div>
</div>

<!-- prettier-ignore -->
<script>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
        ({ key: "AIzaSyCDcOvg6Ufu7WnKBU8A09g_XPcX976N23I", v: "beta" });</script>

<!-- Terms and conditions modal -->
<div class="modal" id="mdlTerms" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content update-info">
            <div class="modal-header">
                <h2 class="modal-title">T√©rminos y condiciones</h2>
            </div>
            <div class="modal-body">
                <div class="form-item">
                    <p>{{chalet.legalNotice}}</p>
                </div>
                <div class="form-item">
                    <div class="signature">
                        <div class="canvas">
                            <button id="btnClrCanvas" class="delete-signature"><span
                                    class="material-symbols-outlined">delete</span></button>
                            <canvas id="signatureCanvas" width="500" height="200"></canvas>
                            <label for="signatureCanvas">Ingrese su firma</label>
                        </div>
                    </div>
                </div>
                <div class="form-item">
                    <div class="checkbox-option">
                        <input type="checkbox" id="chckAcceptTerms" name="chckAcceptTerms">
                        <label for="chckAcceptTerms">He l√©ido y aceptado los t√©rminos y condiciones</label>
                    </div>
                </div>
                <div class="form-item">
                    <p id="txtTermsError" class="error"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-save" id="btnAccept"> Acepto</button>
            </div>
        </div>
    </div>
</div>
{{else}}
<h1>Mega error</h1>
{{/if}}

<script>
    function formatDate(date) {
        const options = {
            weekday: 'short',
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false,
        };
        return new Date(date).toLocaleDateString('en-US', options).replace(',', '');
    }

    document.addEventListener("DOMContentLoaded", () => {
        // Formating dates.
        const departureDate = document.getElementById('departureDate');
        const arrivalDate = document.getElementById('arrivalDate');
        const reservationDate = document.getElementById('reservationDate');
        //departureDate.textContent = formatDate(departureDate.textContent);
        //arrivalDate.textContent = formatDate(arrivalDate.textContent);
        //reservationDate.textContent = formatDate(reservationDate.textContent);

        // Llamar a la API de OpenWeatherMap
        const apiKey = '26d8231cf1380644673deb5e34aad872'; // Reemplaza 'TU_CLAVE_DE_API' con tu clave de API de OpenWeatherMap
        const city = 'Mazamitla'; // Reemplaza 'NOMBRE_DE_LA_CIUDAD' con el nombre de la ciudad que desees
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
        console.log(url);

        // Realizar solicitud a la API
        fetch(url)
            .then(response => response.json())
            .then(data => {
                const weatherDiv = document.getElementById('weather');
                const temperature = data.main.temp;
                const description = data.weather[0].description;
                const cityName = data.name;
                const country = data.sys.country;
                const weatherIcon = data.weather[0].icon;

                // Mapeo de los c√≥digos de iconos de OpenWeatherMap a emoji
                const iconMappings = {
                    "01d": "‚òÄÔ∏è",
                    "01n": "üåô",
                    "02d": "üå§Ô∏è",
                    "02n": "üå§Ô∏è",
                    "03d": "‚òÅÔ∏è",
                    "03n": "‚òÅÔ∏è",
                    "04d": "‚òÅÔ∏è",
                    "04n": "‚òÅÔ∏è",
                    "09d": "üåßÔ∏è",
                    "09n": "üåßÔ∏è",
                    "10d": "üå¶Ô∏è",
                    "10n": "üå¶Ô∏è",
                    "11d": "‚õàÔ∏è",
                    "11n": "‚õàÔ∏è",
                    "13d": "‚ùÑÔ∏è",
                    "13n": "‚ùÑÔ∏è",
                    "50d": "üå´Ô∏è",
                    "50n": "üå´Ô∏è"
                };

                const weatherIconEmoji = iconMappings[weatherIcon] || "‚ùì";

                // Generaci√≥n del contenido HTML con iconos emoji
                weatherDiv.innerHTML = `
                <div class="weather-card">
                    <div class="weather-icon">${weatherIconEmoji}</div>
                    <div class="weather-temp">${temperature}¬∞C</div>
                    <p class="mb-1">${description}</p>
                    <p class="weather-city mb-0"><i class="fa fa-map-marker me-1"></i>${cityName}, ${country}</p>
                </div>
            `;
            })
            .catch(error => console.error('Error fetching weather data:', error));

        // Verify if terms and conditions were already accepted by the user.
        var modal = document.getElementById('mdlTerms');
        fetch(window.location.pathname + "/are-terms-accepted", {
            method: "GET",
            headers: {
                // Once logged in, the authorization token stored inthe session cookies will automatically be added in each HTTP request.
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (!response.ok) {
                    const error = response.statusText;
                    txtTermsError.innerHTML = "Error en la solicitud 1: " + error.toLowerCase() + ".";
                    throw new Error('Error en la solicitud 1: ' + error);
                }
                return response.json();
            })
            .then(data => {
                console.log('Respuesta del servidor 1:', data);
                if (data.termsAccepted) {
                    modal.style.display = "none";
                }
                else {
                    // If they have not been accepted, show them to the user. 
                    modal.style.display = "block";
                    var acceptBtn = document.getElementById("btnAccept");
                    var checkbox = document.getElementById("chckAcceptTerms");
                    var txtTermsError = document.getElementById("txtTermsError")
                    var acceptTerms = false;

                    // Canvas
                    const canvas = document.getElementById('signatureCanvas');
                    var btnClrCanvas = document.getElementById("btnClrCanvas");
                    var btnSaveCanvas = document.getElementById("btnSaveCanvas");
                    var signatureImage;
                    const ctx = canvas.getContext('2d');
                    let isDrawing = false;
                    let lastX = 0;
                    let lastY = 0;

                    // Helper function to get the correct coordinates for both mouse and touch events
                    function getCoordinates(event) {
                        if (event.touches) {
                            return [event.touches[0].clientX - canvas.getBoundingClientRect().left,
                                    event.touches[0].clientY - canvas.getBoundingClientRect().top];
                        } else {
                            return [event.offsetX, event.offsetY];
                        }
                    }

                    // Start drawing (mouse and touch)
                    canvas.addEventListener('mousedown', (e) => {
                        isDrawing = true;
                        [lastX, lastY] = getCoordinates(e);
                    });

                    canvas.addEventListener('touchstart', (e) => {
                        isDrawing = true;
                        [lastX, lastY] = getCoordinates(e);
                        e.preventDefault();  // Prevent scrolling when drawing
                    });

                    // Drawing in motion (mouse and touch)
                    canvas.addEventListener('mousemove', (e) => {
                        if (!isDrawing) return;
                        const [x, y] = getCoordinates(e);
                        ctx.beginPath();
                        ctx.moveTo(lastX, lastY);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        [lastX, lastY] = [x, y];
                    });

                    canvas.addEventListener('touchmove', (e) => {
                        if (!isDrawing) return;
                        const [x, y] = getCoordinates(e);
                        ctx.beginPath();
                        ctx.moveTo(lastX, lastY);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        [lastX, lastY] = [x, y];
                        e.preventDefault();  // Prevent scrolling when drawing
                    });

                    // Stop drawing (mouse and touch)
                    canvas.addEventListener('mouseup', () => isDrawing = false);
                    canvas.addEventListener('touchend', () => isDrawing = false);

                    // Clear canvas
                    btnClrCanvas.addEventListener("click", () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
});


                    // Validate if user entered their signaure and accepted the terms and conditions
                    checkbox.checked = false;
                    acceptBtn.addEventListener("click", () => {
                        if (ctx.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0)) {
                            if (!checkbox.checked) {
                                txtTermsError.innerHTML = "Debes aceptar los t√©rminos y condiciones";
                            } else {
                                signatureImage = canvas.toDataURL();
                                console.log(signatureImage);
                                console.log(chckAcceptTerms.checked);
                                acceptTerms = true;

                                fetch(window.location.pathname + "/accept-terms", {
                                    method: "POST",
                                    headers: {
                                        // Once logged in, the authorization token stored inthe session cookies will automatically be added in each HTTP request.
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        termsAccepted: chckAcceptTerms.checked
                                    })
                                })
                                    .then(response => {
                                        if (!response.ok) {
                                            const error = response.statusText;
                                            txtTermsError.innerHTML = "Error en la solicitud 2: " + error.toLowerCase() + ".";
                                            throw new Error('Error en la solicitud 2: ' + error);
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        console.log('Respuesta del servidor 2:', data);
                                        modal.style.display = "none";
                                    })
                                    .catch(error => {
                                        console.error('Error al enviar la solicitud 2:', error);
                                    });
                            }
                        } else {
                            txtTermsError.innerHTML = "Debes ingresar tu firma";
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Error al enviar la solicitud 1:', error);
            });
    })

    jQuery(document).ready(function($) {
        
        const checkInBtn = $('#checkin-btn');
        checkInBtn.click(async function(e) {
            e.preventDefault();
            const reservationId = $(this).attr('data-reservationid');
            console.log(reservationId)
            await $.ajax({
                type: "POST",
                data: {idReserva: reservationId},
                dataType: "json",
                url: `/instrucciones/realizarcheckin?id=${reservationId}`,
                success: function(response) {
                    console.log(response);
                    Swal.fire({
                        title: 'Check-in realizado!',
                        icon:'success',
                        confirmButtonText: 'Aceptar',
                        confirmButtonColor: '#7ECEC5',
                        background: '#fff'
                    }).then((result) =>{
                        window.location.reload()
                    })
                    
                },
                error: function(xhr, status, error) {
                    console.log(xhr.responseText);
                    Swal.fire({
                        title: 'Error al realizar el check-in',
                        text: xhr.responseText,
                        icon: 'error',
                        confirmButtonText: 'Cerrar',
                        confirmButtonColor: '#FF6B6B',
                        background: '#fff'
                    })
                }
            })

        })
    });

        



</script>